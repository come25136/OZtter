var TweetDisplay="#tweets";function main(a,c,b){if(window.EventSource){connect(a,c,b)}else{alert("EventSourceに対応していません")}}function connect(a,c,b){var d=new EventSource("push.php?at="+a+"&ats="+c);d.addEventListener("Info",function(g){var f=Init(b,g);add_tweet(m_random(18),f.icon_url,f.value)},false);d.addEventListener("Tweet",function(g){var f=Init(b,g);add_tweet(f.id,f.icon_url,f.value)},false);d.addEventListener("Error",function(g){var f=Init(b,g);if(f.value=="89"){location.href="reset.php"}else{if(f.value=="88"){d.close();setTimeout(function(){connect(a,c,b)},300000)}}},false)}function Init(a,b){while($(TweetDisplay).find("div").length>=a){$(TweetDisplay+" div")[0].remove()}return validateJSON(b.data)}function add_tweet(c,a,b){$(TweetDisplay).append('<div class="tweet" id="'+c+'" style="top:'+Math.floor(Math.random()*(window.innerHeight-100))+"px; left:"+Math.floor(Math.random()*(window.innerWidth-300))+'px;"><div class="title_bar"><button class="close" title="閉じる"><span class="cross"></span></button></div><img class="icon"  align="left" src="'+a+'"><p class="value">'+b.replace(/\r\n?/g,"<br>")+"</p></div>")}function validateJSON(text){var obj=null;try{obj=JSON.parse(text);return obj}catch(O_o){}try{obj=eval("("+text+")")}catch(o_O){console.log("ERROR. JSON.parse failed");return null}console.log("WARN. As a result of JSON.parse, a trivial problem has occurred");return obj}function m_random(b){var d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var a="";while(a.length<b){a+=d[Math.floor(Math.random()*d.length)]}return a};